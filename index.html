<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Mahjong Neon – FINAL</title>
<style>
html,body{
  margin:0; padding:0; width:100%; height:100%; overflow:hidden;
  background:#5b3a1e; font-family:Arial,sans-serif;
}
#menu,#game{
  position:absolute; inset:0; display:flex; justify-content:center; align-items:center;
}
#menu{flex-direction:column; gap:12px;}
button{font-size:18px; padding:12px 32px; cursor:pointer;}
#game{display:none; flex-direction:column; align-items:center;}
#ui{color:white; text-align:center; margin-bottom:10px;}
#score{font-size:24px;}
#msg{font-size:20px; margin-top:5px; transition:all 0.3s;}
#board{position:relative; background:#b38b5c; border-radius:12px;}
.tile{
  position:absolute; background:white; border-radius:10px; box-sizing:border-box;
  display:flex; justify-content:center; align-items:center; transition:opacity .2s, filter .2s;
}
.tile img{width:80%; height:80%; object-fit:contain;}
.tile.free{ cursor:pointer; opacity:1; }
.tile.blocked{ opacity:.45; filter:grayscale(80%); pointer-events:none; }
#inventory{display:flex; gap:10px; margin-top:12px;}
.inv{width:60px; height:60px; background:#eee; border-radius:8px; display:flex; justify-content:center; align-items:center;}
.inv img{width:80%; height:80%;}
</style>
</head>
<body>

<div id="menu">
  <button onclick="start('easy')">łatwy</button>
  <button onclick="start('medium')">średni</button>
  <button onclick="start('hard')">trudny</button>
  <button onclick="start('extreme')">ekstremalny</button>
  <button onclick="start('pro')">zawodowy</button>
</div>

<div id="game">
  <div id="ui">
    <div id="score">Score: 0</div>
    <div id="msg"></div>
  </div>
  <div id="board"></div>
  <div id="inventory"></div>
</div>

<audio id="click" src="assets/sounds/click.mp3"></audio>
<audio id="pair" src="assets/sounds/pair.mp3"></audio>

<script>
const COLORS=["#ff004c","#00e5ff","#ffee00","#00ff6a","#a855ff","#ff8c00","#00ffcc","#ff5ea8"];
const LEVELS={ easy:[3,2], medium:[4,3,2], hard:[5,4,3,2], extreme:[6,5,4,3], pro:[7,6,5,4,3] };

const menu=document.getElementById("menu");
const game=document.getElementById("game");
const board=document.getElementById("board");
const invEl=document.getElementById("inventory");
const scoreEl=document.getElementById("score");
const msgEl=document.getElementById("msg");
const clickS=document.getElementById("click");
const pairS=document.getElementById("pair");

let tiles=[], inventory=[], score=0, lastTime=0;

// 7 różnych kształtów piramid
function getShape(n){
  const shapes=[
    {w:n,h:n},             // kwadrat
    {w:n,h:n-1},           // prostokąt poziomy
    {w:n-1,h:n},           // prostokąt pionowy
    {w:n,h:n},             // kwadrat mały
    {w:Math.ceil(n/2),h:n},// pionowe
    {w:n,h:Math.ceil(n/2)},// poziome
    {w:n-1,h:n-1}          // mniejszy kwadrat
  ];
  return shapes[Math.floor(Math.random()*shapes.length)];
}

function start(level){
  menu.style.display="none"; game.style.display="flex";
  reset(); build(LEVELS[level]);
  lastTime=performance.now();
}

function reset(){
  board.innerHTML=""; invEl.innerHTML=""; tiles=[]; inventory=[]; score=0;
  scoreEl.innerText="Score: 0"; msgEl.innerText="";
}

function build(layers){
  const size=Math.min(innerWidth,innerHeight)*0.85;
  board.style.width=size+"px"; board.style.height=size+"px";
  const max=layers[0];
  const tileSize=size/max;
  let img=1, color=0;

  layers.forEach((n,z)=>{
    const off=(max-n)/2*tileSize;
    const shape=getShape(n);
    for(let y=0;y<shape.h;y++){
      for(let x=0;x<shape.w;x++){
        const t=document.createElement("div"); t.className="tile";
        t.style.width=tileSize+"px"; t.style.height=tileSize+"px";
        t.style.left=off+x*tileSize+"px"; t.style.top=off+y*tileSize+"px";
        t.style.border="4px solid "+COLORS[color%COLORS.length];
        t.dataset.img=img; t.dataset.color=COLORS[color%COLORS.length]; t.dataset.z=z;
        const im=document.createElement("img"); im.src=`assets/images/${img}.png`;
        t.appendChild(im);
        t.onclick=()=>clickTile(t);
        board.appendChild(t); tiles.push(t);
        img++; if(img>16) img=1; color++;
      }
    }
  });
  updateFree();
}

function clickTile(t){
  if(t.classList.contains("blocked")) return;
  clickS.play();
  inventory.push({img:t.dataset.img,color:t.dataset.color});
  tiles.splice(tiles.indexOf(t),1); t.remove();
  updateFree(); renderInv();
  if(inventory.length===4) checkInv();
}

function updateFree(){
  tiles.forEach(t=>{
    const z=+t.dataset.z;
    const blocked=tiles.some(o=>o!==t && +o.dataset.z>z && overlap(t,o));
    t.className="tile "+(blocked?"blocked":"free");
  });
}

function overlap(a,b){
  const A=a.getBoundingClientRect(), B=b.getBoundingClientRect();
  return !(A.right<=B.left||A.left>=B.right||A.bottom<=B.top||A.top>=B.bottom);
}

function renderInv(){
  invEl.innerHTML="";
  inventory.forEach(i=>{
    const d=document.createElement("div"); d.className="inv";
    const im=document.createElement("img"); im.src=`assets/images/${i.img}.png`;
    d.appendChild(im); invEl.appendChild(d);
  });
}

function checkInv(){
  const [a,b,c,d]=inventory;
  const ok=(a.img===b.img && b.img===c.img && c.img===d.img &&
            a.color===b.color && b.color===c.color && c.color===d.color);
  const dt=(performance.now()-lastTime)/1000;
  lastTime=performance.now();
  if(ok){ pairS.play(); addScore(dt); }
  inventory=[]; renderInv();
}

function addScore(dt){
  let pts=50,msg="good";
  if(dt<=1.4){pts=500;msg="you are the legend!";}
  else if(dt<=3.5){pts=350;msg="its impossible!";}
  else if(dt<=5){pts=250;msg="insane";}
  else if(dt<=7.5){pts=150;msg="awesome";}
  else if(dt<=10){pts=100;msg="nice";}
  score+=pts; animateScore(msg,pts);
}

function animateScore(msg,pts){
  msgEl.innerText=msg;
  let start=score-pts, end=score, duration=300, startTime=null;
  function step(timestamp){
    if(!startTime) startTime=timestamp;
    let progress=(timestamp-startTime)/duration;
    if(progress>1) progress=1;
    scoreEl.innerText="Score: "+Math.floor(start + (end-start)*progress);
    if(progress<1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}
</script>
</body>
</html>

