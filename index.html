<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Case Opener Game</title>

<style>
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{
    margin:0;
    background:radial-gradient(circle at top,#1b1b2b,#08080f);
    color:white;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:30px;
}
.hidden{display:none}
h1{margin-bottom:10px}

.balance{
    font-size:22px;
    color:gold;
    font-weight:bold;
    margin-bottom:20px;
}

button{
    padding:12px 22px;
    font-size:16px;
    border:none;
    border-radius:10px;
    background:linear-gradient(45deg,gold,orange);
    font-weight:bold;
    cursor:pointer;
}
button:disabled{opacity:.5;cursor:not-allowed}

/* ===== LOBBY ===== */
#lobby{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:20px;
    width:100%;
    max-width:900px;
}

.case-card{
    background:#111;
    border-radius:14px;
    padding:20px;
    text-align:center;
    box-shadow:0 0 20px rgba(0,0,0,.6);
}
.case-card h3{margin:10px 0}
.price{color:gold;margin-bottom:10px}

/* ===== CASE VIEW ===== */
.case{
    position:relative;
    width:900px;
    height:180px;
    overflow:hidden;
    border-radius:16px;
    background:linear-gradient(180deg,#111,#1c1c1c);
    box-shadow:0 0 40px rgba(0,0,0,.8);
    margin-bottom:20px;
}
.clamp{
    position:absolute;
    left:50%;
    top:0;
    transform:translateX(-50%);
    width:4px;
    height:100%;
    background:gold;
    box-shadow:0 0 15px gold;
    z-index:10;
}
.tape{
    display:flex;
    align-items:center;
    height:100%;
    gap:14px;
    padding:0 400px;
    transition:transform 6s cubic-bezier(.1,.7,.1,1);
}
.item{
    width:120px;
    height:120px;
    background:#000;
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-shrink:0;
}
.item img{width:80%}

/* ===== RARITIES ===== */
.common{border:3px solid #555}
.rare{border:3px solid #3fa9ff;box-shadow:0 0 10px #3fa9ff}
.epic{border:3px solid #b84dff;box-shadow:0 0 18px #b84dff}
.mythic{border:5px solid red;box-shadow:0 0 28px red}
.legendary{
    border:5px solid gold;
    animation:glow 1.2s infinite alternate;
}
@keyframes glow{
    from{box-shadow:0 0 10px gold}
    to{box-shadow:0 0 35px gold}
}

.result{
    display:flex;
    gap:20px;
    align-items:center;
}
.result .item{width:160px;height:160px}
.result-price{font-size:26px;color:gold;font-weight:bold}
</style>
</head>

<body>

<h1>üéÅ Case Opener</h1>
<div class="balance">üí∞ Saldo: <span id="balance">0</span> $</div>

<!-- ===== LOBBY ===== -->
<div id="lobby"></div>

<!-- ===== GAME ===== -->
<div id="game" class="hidden">
    <div class="case">
        <div class="clamp"></div>
        <div class="tape" id="tape"></div>
    </div>

    <button id="openBtn">OTW√ìRZ SKRZYNKƒò</button>
    <button onclick="backToLobby()">‚¨Ö POWR√ìT DO LOBBY</button>

    <div class="result" id="result"></div>
</div>

<audio id="clickSound" src="assets/sounds/click.mp3"></audio>
<audio id="dropSound" src="assets/sounds/drop.mp3"></audio>

<script>
/* ===== DATA ===== */
const images=Array.from({length:16},(_,i)=>({
    src:`assets/images/${i+1}.png`,
    base:i+1
}));

const cases=[
{
    name:"Normal Case",
    price:0,
    maxImg:3,
    chances:[
        {name:'common',chance:90,m:1},
        {name:'rare',chance:9,m:3},
        {name:'epic',chance:1,m:7}
    ]
},
{
    name:"Bronze Case",
    price:1,
    maxImg:5,
    chances:[
        {name:'common',chance:80,m:1},
        {name:'rare',chance:15,m:3},
        {name:'epic',chance:4,m:7},
        {name:'mythic',chance:1,m:10}
    ]
},
{
    name:"Classic Case",
    price:3,
    maxImg:8,
    chances:[
        {name:'common',chance:70,m:1},
        {name:'rare',chance:15,m:3},
        {name:'epic',chance:10,m:7},
        {name:'mythic',chance:4,m:10},
        {name:'legendary',chance:1,m:30}
    ]
},
{
    name:"Silver Case",
    price:12,
    maxImg:10,
    chances:[
        {name:'common',chance:50,m:1},
        {name:'rare',chance:30,m:3},
        {name:'epic',chance:15,m:7},
        {name:'mythic',chance:4,m:10},
        {name:'legendary',chance:1,m:30}
    ]
},
{
    name:"Holy 50/50",
    price:15,
    maxImg:1,
    chances:[
        {name:'common',chance:50,m:1},
        {name:'legendary',chance:50,m:30}
    ]
},
{
    name:"Golden Case",
    price:20,
    maxImg:16,
    chances:[
        {name:'common',chance:30,m:1},
        {name:'rare',chance:30,m:3},
        {name:'epic',chance:30,m:7},
        {name:'mythic',chance:9,m:10},
        {name:'legendary',chance:1,m:30}
    ]
}
];

let balance=0;
let activeCase=null;
let canClick=true;

const lobby=document.getElementById("lobby");
const game=document.getElementById("game");
const balanceEl=document.getElementById("balance");
const tape=document.getElementById("tape");
const resultBox=document.getElementById("result");
const openBtn=document.getElementById("openBtn");

const clickSound=document.getElementById("clickSound");
const dropSound=document.getElementById("dropSound");

/* ===== LOBBY ===== */
function renderLobby(){
    lobby.innerHTML="";
    cases.forEach((c,i)=>{
        const d=document.createElement("div");
        d.className="case-card";
        d.innerHTML=`
            <h3>${c.name}</h3>
            <div class="price">${c.price}$</div>
            <button onclick="enterCase(${i})">WYBIERZ</button>
        `;
        lobby.appendChild(d);
    });
}
renderLobby();

/* ===== ENTER ===== */
function enterCase(i){
    const c=cases[i];
    if(balance<c.price){
        alert("Brak ≈õrodk√≥w");
        return;
    }
    balance-=c.price;
    balanceEl.textContent=balance;
    activeCase=c;
    lobby.classList.add("hidden");
    game.classList.remove("hidden");
}

/* ===== BACK ===== */
function backToLobby(){
    game.classList.add("hidden");
    lobby.classList.remove("hidden");
    resultBox.innerHTML="";
}

/* ===== RNG ===== */
function rollRarity(){
    let r=Math.random()*100,s=0;
    for(const c of activeCase.chances){
        s+=c.chance;
        if(r<=s) return c;
    }
}

function randomItem(){
    const img=images[Math.floor(Math.random()*activeCase.maxImg)];
    const rarity=rollRarity();
    return{
        img:img.src,
        base:img.base,
        rarity,
        price:img.base*rarity.m
    };
}

function createItem(item){
    const d=document.createElement("div");
    d.className=`item ${item.rarity.name}`;
    const i=document.createElement("img");
    i.src=item.img;
    d.appendChild(i);
    return d;
}

/* ===== OPEN ===== */
openBtn.onclick=()=>{
    if(!canClick) return;
    canClick=false;
    openBtn.disabled=true;

    clickSound.currentTime=0;
    clickSound.play();

    tape.style.transition="none";
    tape.style.transform="translateX(0)";
    tape.innerHTML="";
    resultBox.innerHTML="";

    const items=[];
    for(let i=0;i<40;i++){
        const it=randomItem();
        items.push(it);
        tape.appendChild(createItem(it));
    }

    const winIndex=30;
    const winItem=items[winIndex];

    setTimeout(()=>{
        tape.style.transition="transform 6s cubic-bezier(.1,.7,.1,1)";
        tape.style.transform=`translateX(-${winIndex*134}px)`;
    },50);

    setTimeout(()=>{
        dropSound.currentTime=0;
        dropSound.play();

        resultBox.appendChild(createItem(winItem));
        const p=document.createElement("div");
        p.className="result-price";
        p.innerHTML=`${winItem.price}$<br><small>${winItem.base}$ √ó ${winItem.rarity.m}</small>`;
        resultBox.appendChild(p);

        balance+=winItem.price;
        balanceEl.textContent=balance;
    },6200);

    setTimeout(()=>{
        canClick=true;
        openBtn.disabled=false;
    },7000);
};
</script>

</body>
</html>
