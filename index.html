<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neon Memory Blast 3D</title>
<style>
body {margin:0; font-family:Arial,sans-serif; background:#000; color:#fff; text-align:center;}
#menu {padding:20px;}
#menu button {margin:10px; padding:12px 24px; font-size:18px; cursor:pointer; border:2px solid #0ff; border-radius:8px; background:#000; color:#0ff;}
.hidden {display:none;}
#game {padding:10px;}
#score {font-size:20px; margin-bottom:10px;}
#board {position:relative; width:900px; height:600px; margin:0 auto; perspective:1000px;}
.card {width:80px; height:80px; border:4px solid #fff; border-radius:6px; background:#111; cursor:pointer; position:absolute; display:flex; align-items:center; justify-content:center;}
.card img {max-width:70%; max-height:70%; opacity:0; transition:0.1s;}
.card.revealed img {opacity:1;}
.card.locked {opacity:0.3; cursor:default;}
</style>
</head>
<body>

<div id="menu">
<h1>Neon Memory Blast 3D</h1>
<button onclick="startLevel('easy')">Łatwy (10 par)</button>
<button onclick="startLevel('classic')">Klasyczny (20 par)</button>
<button onclick="startLevel('medium')">Średni (30 par)</button>
<button onclick="startLevel('hard')">Trudny (60 par)</button>
<button onclick="startLevel('extreme')">Ekstremalny (100 par)</button>
<button onclick="startLevel('pro')">Zawodowy (160 par)</button>
</div>

<div id="game" class="hidden">
<div id="score">Wynik: 0</div>
<div id="board"></div>
<button onclick="backToMenu()">Powrót do menu</button>
</div>

<audio id="bg" src="assets/sounds/bg.mp3" loop></audio>
<audio id="click" src="assets/sounds/click.mp3"></audio>
<audio id="match" src="assets/sounds/match.mp3"></audio>
<audio id="win" src="assets/sounds/win.mp3"></audio>

<script>
const colors=["#ff0","#0ff","#f0f","#0f0","#f0f"];
const baseImagesCount=16;
const levelConfig={easy:10,classic:20,medium:30,hard:60,extreme:100,pro:160};
let boardEl=document.getElementById("board");
let scoreEl=document.getElementById("score");
let score=0, firstCard=null, lockBoard=false;
let bgSound=document.getElementById("bg"), clickS=document.getElementById("click"), matchS=document.getElementById("match"), winS=document.getElementById("win");

function startLevel(level){
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");
  score=0; scoreEl.textContent="Wynik: 0";
  bgSound.play();
  buildPyramid(levelConfig[level]);
}

function backToMenu(){
  document.getElementById("menu").classList.remove("hidden");
  document.getElementById("game").classList.add("hidden");
  boardEl.innerHTML="";
  bgSound.pause(); bgSound.currentTime=0;
}

// Prosty generator piramid 3D
function buildPyramid(pairCount){
  let pairs=[];
  for(let i=0;i<pairCount;i++){
    let img=(i%baseImagesCount)+1;
    let color=colors[i%colors.length];
    pairs.push({img,color}); pairs.push({img,color});
  }
  pairs=shuffleArray(pairs);

  boardEl.innerHTML="";
  let positions=[]; // x,y,z
  let layers=Math.ceil(Math.cbrt(pairs.length)); // liczba warstw
  let index=0;
  for(let z=0;z<layers;z++){
    let rowCount=layers-z;
    for(let y=0;y<rowCount;y++){
      for(let x=0;x<rowCount;x++){
        if(index>=pairs.length) break;
        positions.push({x: x, y: y, z: z, data:pairs[index]});
        index++;
      }
    }
  }

  const offset=80; const layerShift=10;
  positions.forEach(pos=>{
    let card=document.createElement("div");
    card.classList.add("card");
    card.dataset.img=pos.data.img;
    card.dataset.color=pos.data.color;
    card.style.borderColor=pos.data.color;
    card.style.left=(pos.x*offset + pos.z*layerShift)+"px";
    card.style.top=(pos.y*offset - pos.z*layerShift)+"px";
    card.style.zIndex=pos.z*100+pos.y*10+pos.x;
    let imgEl=document.createElement("img");
    imgEl.src=`assets/images/${pos.data.img}.png`;
    card.appendChild(imgEl);
    card.onclick=()=>flipCard(card);
    boardEl.appendChild(card);
  });
}

// mechanika dopasowania (z logiką Mahjong: tylko wolne kafelki)
function flipCard(card){
  if(lockBoard||card===firstCard||card.classList.contains("locked")||!isFree(card)) return;
  clickS.play();
  card.classList.add("revealed");
  if(!firstCard){firstCard=card; return;}
  
  if(firstCard.dataset.img===card.dataset.img&&firstCard.dataset.color===card.dataset.color){
    score+=10; scoreEl.textContent=`Wynik: ${score}`;
    matchS.play();
    firstCard.classList.add("locked");
    card.classList.add("locked");
    resetTurn();
    if(document.querySelectorAll('.card:not(.locked)').length===0) winS.play();
  } else {
    lockBoard=true;
    setTimeout(()=>{
      firstCard.classList.remove("revealed");
      card.classList.remove("revealed");
      resetTurn();
    },1000);
  }
}

function resetTurn(){[firstCard,lockBoard]=[null,false];}
function shuffleArray(a){for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} return a;}

// sprawdza czy kafelek jest wolny (Mahjong logic)
function isFree(card){
  let rect=card.getBoundingClientRect();
  let cards=[...document.querySelectorAll('.card')].filter(c=>!c.classList.contains('locked')&&c!==card);
  for(let c of cards){
    let r=c.getBoundingClientRect();
    if(Math.abs(rect.top - r.top)<=10 && (rect.left-r.left)==-80) return false; // lewo
    if(Math.abs(rect.top - r.top)<=10 && (rect.left-r.left)==80) return false;  // prawo
    if(Math.abs(rect.top - r.top)<=80 && Math.abs(rect.left - r.left)<=80 && parseInt(c.style.zIndex)>parseInt(card.style.zIndex)) return false; // nad
  }
  return true;
}
</script>

</body>
</html>

