<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mahjong Neon</title>

<style>
html,body{
    margin:0;
    width:100%;
    height:100%;
    overflow:hidden;
    font-family:Arial,Helvetica,sans-serif;
    background:#3a2412;
}

#game{
    position:relative;
    width:100%;
    height:100%;
    background:
        radial-gradient(circle at center,#7a4a25 0%,#3a2412 70%),
        repeating-linear-gradient(
            45deg,
            rgba(255,255,255,0.04),
            rgba(255,255,255,0.04) 10px,
            rgba(0,0,0,0.04) 10px,
            rgba(0,0,0,0.04) 20px
        );
}

/* ===== MENU ===== */
#menu{
    position:absolute;
    inset:0;
    background:rgba(0,0,0,.65);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    z-index:1000;
}
#menu h1{
    color:#fff;
    margin-bottom:20px;
    font-size:42px;
    text-shadow:0 0 20px #0ff;
}
.menu-btn{
    padding:14px 30px;
    margin:6px;
    font-size:18px;
    border:none;
    border-radius:14px;
    cursor:pointer;
    background:#fff;
    box-shadow:0 0 20px #0ff;
}
.menu-btn:hover{transform:scale(1.07);}

/* ===== TILE ===== */
.tile{
    position:absolute;
    border-radius:16px;
    background:white;
    cursor:pointer;
    transition:transform .25s, box-shadow .25s, opacity .25s;
    animation:neonPulse 2s infinite alternate;
}
.tile img{
    width:100%;
    height:100%;
    object-fit:contain;
    pointer-events:none;
}
.tile:hover{transform:scale(1.08);}
@keyframes neonPulse{
    from{box-shadow:0 0 12px currentColor;}
    to{box-shadow:0 0 28px currentColor, 0 0 60px currentColor;}
}

/* ===== INVENTORY ===== */
#inventory{
    position:absolute;
    bottom:10px;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    gap:14px;
}
.inv-slot{
    width:72px;
    height:72px;
    background:white;
    border-radius:14px;
    box-shadow:0 0 15px #000;
    display:flex;
    align-items:center;
    justify-content:center;
}
.inv-slot img{width:90%;height:90%;}

/* ===== UI ===== */
#ui{
    position:absolute;
    top:10px;
    left:10px;
    color:white;
    font-size:18px;
    text-shadow:0 0 6px #000;
}

/* ===== POPUP TEXT ===== */
#popup{
    position:absolute;
    top:45%;
    left:50%;
    transform:translate(-50%,-50%);
    font-size:38px;
    font-weight:bold;
    opacity:0;
    pointer-events:none;
    transition:.3s;
    text-shadow:0 0 30px currentColor;
}
#popup.show{
    opacity:1;
    transform:translate(-50%,-60%);
}
</style>
</head>

<body>
<div id="game">

<div id="menu">
    <h1>MAHJONG NEON</h1>
    <button class="menu-btn" onclick="startLevel('easy')">Łatwy</button>
    <button class="menu-btn" onclick="startLevel('medium')">Średni</button>
    <button class="menu-btn" onclick="startLevel('hard')">Trudny</button>
    <button class="menu-btn" onclick="startLevel('extreme')">Ekstremalny</button>
    <button class="menu-btn" onclick="startLevel('pro')">Zawodowy</button>
</div>

<div id="ui">
    Score: <span id="score">0</span><br>
    Combo: <span id="combo">1</span><br>
    Time: <span id="time">0.0</span>s
</div>

<div id="popup"></div>

<div id="inventory">
    <div class="inv-slot"></div>
    <div class="inv-slot"></div>
    <div class="inv-slot"></div>
    <div class="inv-slot"></div>
</div>

</div>

<script>
/* ===== AUDIO ===== */
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function beep(f,d){
 const o=audioCtx.createOscillator();
 const g=audioCtx.createGain();
 o.type="sine"; // łagodny ton
 o.frequency.value=f;
 o.connect(g); g.connect(audioCtx.destination);
 g.gain.value=.1; // delikatny
 o.start();
 setTimeout(()=>o.stop(),d*1000);
}

/* ===== DATA ===== */
const colors=["#ff0033","#00e5ff","#ffee00","#00ff55","#ff00ff","#00ffaa","#ff8800","#8888ff"];
const LEVELS={
 easy:[3,2],
 medium:[4,3,2],
 hard:[5,4,3,2],
 extreme:[6,5,4,3],
 pro:[7,6,5,4,3]
};

let layers=[],board=[],inventory=[];
let score=0,combo=1,lastPairTime=Date.now();

const game=document.getElementById("game");
const menu=document.getElementById("menu");
const scoreSpan=document.getElementById("score");
const comboSpan=document.getElementById("combo");
const timeSpan=document.getElementById("time");
const popup=document.getElementById("popup");

/* ===== START ===== */
function startLevel(lvl){
 layers=LEVELS[lvl];
 menu.style.display="none";
 generate();
}

/* ===== SCORE BY TIME ===== */
function getScoreByTime(){
 const d=(Date.now()-lastPairTime)/1000;
 lastPairTime=Date.now();
 if(d<=1.4){show("YOU ARE THE LEGEND!","#ff00ff");return 500;}
 if(d<=3.5){show("IT'S IMPOSSIBLE!","#00e5ff");return 350;}
 if(d<=5){show("INSANE","#ff0033");return 250;}
 if(d<=7.5){show("AWESOME","#ffee00");return 150;}
 if(d<=10){show("NICE","#00ff55");return 100;}
 show("GOOD","#fff");return 50;
}

function show(t,c){
 popup.textContent=t;
 popup.style.color=c;
 popup.classList.add("show");
 setTimeout(()=>popup.classList.remove("show"),800);
}

/* ===== GAME LOGIC ===== */
function generate(){
 board=[];inventory=[];score=0;combo=1;
 lastPairTime=Date.now();

 const total=layers.reduce((a,b)=>a+b*b,0);
 let pool=[],img=1,col=0;
 while(pool.length<total){
  for(let i=0;i<2;i++) pool.push({img,col});
  col++; if(col>=colors.length){col=0;img++; if(img>16)img=1;}
 }
 pool.sort(()=>Math.random()-0.5);

 let i=0;
 layers.forEach((s,z)=>{
  for(let y=0;y<s;y++)
   for(let x=0;x<s;x++)
    board.push({x,y,z,img:pool[i].img,color:colors[pool[i++].col],removed:false});
 });
 render();
}

function isFree(t){
 if(t.removed) return false;
 if(board.some(o=>!o.removed&&o.z>t.z&&o.x===t.x&&o.y===t.y)) return false;
 const l=board.some(o=>!o.removed&&o.z===t.z&&o.x===t.x-1&&o.y===t.y);
 const r=board.some(o=>!o.removed&&o.z===t.z&&o.x===t.x+1&&o.y===t.y);
 return !(l&&r);
}

function select(t){
 if(!isFree(t)) {beep(180,.15);return;}
 beep(400,.1);
 inventory.push(t); t.removed=true;

 for(let i=0;i<inventory.length;i++)
  for(let j=i+1;j<inventory.length;j++)
   if(inventory[i].img===inventory[j].img && inventory[i].color===inventory[j].color){
    inventory.splice(j,1); inventory.splice(i,1);
    score+=getScoreByTime()*combo;
    combo++;
    beep(700,.12);
    render(); return;
   }

 if(inventory.length===4){
  beep(220,.4);
  alert("Ekwipunek pełny!");
  menu.style.display="flex";
 }
 if(board.every(t=>t.removed)){
  beep(800,.3);
  alert("WYGRANA! SCORE: "+score);
  menu.style.display="flex";
 }
 render();
}

/* ===== RENDER ===== */
function render(){
 document.querySelectorAll(".tile").forEach(e=>e.remove());

 const max=Math.max(...layers);
 const screen=Math.min(innerWidth,innerHeight*0.8);
 const size=Math.max(80,Math.min(screen/(max+1),160));

 // Margines aby nie wychodziło poza ekran
 const offsetX=(innerWidth-screen)/2;
 const offsetY=(innerHeight*0.8-screen)/2;

 board.forEach(t=>{
  if(t.removed) return;
  const d=document.createElement("div");
  d.className="tile";
  d.style.width=size+"px";
  d.style.height=size+"px";
  d.style.color=t.color;
  d.style.border="4px solid "+t.color;
  d.style.left=Math.min(offsetX+(t.x+(max-t.z)/2)*size,innerWidth-size)+"px";
  d.style.top=Math.min(offsetY+(t.y+(max-t.z)/2)*size,innerHeight*0.8-size)+"px";

  const i=document.createElement("img");
  i.src=`assets/images/${t.img}.png`;
  d.appendChild(i);

  if(isFree(t)) d.onclick=()=>select(t);
  else d.style.opacity=.45;

  game.appendChild(d);
 });

 document.querySelectorAll(".inv-slot").forEach((s,i)=>{
  s.innerHTML="";
  if(inventory[i]){
   const im=document.createElement("img");
   im.src=`assets/images/${inventory[i].img}.png`;
   s.appendChild(im);
  }
 });

 scoreSpan.textContent=score;
 comboSpan.textContent=combo;
}

/* ===== TIMER ===== */
setInterval(()=>timeSpan.textContent=((Date.now()-lastPairTime)/1000).toFixed(1),100);
</script>
</body>
</html>



