<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Mahjong Neon</title>

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  overflow:hidden;
  font-family:Arial, sans-serif;
  background:#7b5a3a;
}

#menu,#game{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
}

#menu{
  flex-direction:column;
  gap:14px;
  background:radial-gradient(circle,#9b7a55,#6b4a2f);
}

button{
  padding:14px 24px;
  font-size:18px;
  cursor:pointer;
}

#game{
  display:none;
}

#board{
  position:relative;
  width:100vmin;
  height:100vmin;
  max-width:100vw;
  max-height:100vh;
}

.tile{
  position:absolute;
  background:#fff;
  border-radius:10px;
  box-sizing:border-box;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:opacity .2s, transform .15s;
}

.tile img{
  width:75%;
  height:75%;
  object-fit:contain;
  pointer-events:none;
}

.tile.blocked{
  opacity:.45;
  pointer-events:none;
}

.tile.free{
  cursor:pointer;
}

#ui{
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  color:white;
  text-align:center;
  z-index:9999;
}

#inventory{
  display:flex;
  gap:8px;
  justify-content:center;
  margin-top:6px;
}

.slot{
  width:48px;
  height:48px;
  background:#eee;
  border-radius:6px;
  border:2px solid #444;
  display:flex;
  align-items:center;
  justify-content:center;
}

#message{
  font-size:20px;
  margin-top:6px;
}
</style>
</head>

<body>

<div id="menu">
  <h1>Mahjong Neon</h1>
  <button onclick="startGame('easy')">Łatwy</button>
  <button onclick="startGame('medium')">Średni</button>
  <button onclick="startGame('hard')">Trudny</button>
  <button onclick="startGame('extreme')">Ekstremalny</button>
  <button onclick="startGame('pro')">Zawodowy</button>
</div>

<div id="game">
  <div id="ui">
    <div>Score: <span id="score">0</span></div>
    <div id="inventory"></div>
    <div id="message"></div>
  </div>
  <div id="board"></div>
</div>

<audio id="clickSound" src="assets/sounds/click.mp3"></audio>
<audio id="pairSound" src="assets/sounds/pair.mp3"></audio>

<script>
/* ===== KONFIG ===== */

const COLORS=[
  '#ff004c','#00eaff','#ffe600','#00ff7f',
  '#b400ff','#ff7b00','#00ffea','#ff00ff'
];

const SHAPES=[
  [3,2],
  [4,3,2],
  [5,4,3,2],
  [6,5,4,3],
  [7,6,5,4,3],
  [7,5,5,3,3],
  [5,6,7,6,5]
];

const LEVELS={
  easy:SHAPES[0],
  medium:SHAPES[2],
  hard:SHAPES[3],
  extreme:SHAPES[4],
  pro:SHAPES[6]
};

/* ===== STAN ===== */

let tiles=[];
let inventory=[];
let score=0;
let lastTime=performance.now();

/* ===== START ===== */

function startGame(level){
  document.getElementById('menu').style.display='none';
  document.getElementById('game').style.display='flex';
  score=0;
  inventory=[];
  document.getElementById('score').textContent=0;
  document.getElementById('message').textContent='';
  buildBoard(LEVELS[level]);
}

/* ===== GENERATOR ===== */

function buildBoard(layers){
  const board=document.getElementById('board');
  board.innerHTML='';
  tiles=[];

  const maxLayer=Math.max(...layers);
  const tileSize=board.clientWidth/maxLayer;

  let pairs=[];
  for(let i=0;i<layers.reduce((a,b)=>a+b*b,0)/2;i++){
    const img=(i%16)+1;
    const color=COLORS[i%COLORS.length];
    pairs.push({img,color},{img,color});
  }

  pairs.sort(()=>Math.random()-.5);

  let idx=0;
  layers.forEach((count,z)=>{
    const size=count*tileSize;
    const ox=(board.clientWidth-size)/2;
    const oy=(board.clientHeight-size)/2;

    for(let y=0;y<count;y++){
      for(let x=0;x<count;x++){
        const p=pairs[idx++];
        const d=document.createElement('div');
        d.className='tile';
        d.style.width=tileSize+'px';
        d.style.height=tileSize+'px';
        d.style.left=ox+x*tileSize+'px';
        d.style.top=oy+y*tileSize+'px';
        d.style.border='4px solid '+p.color;
        d.style.zIndex=z;

        d.dataset.img=p.img;
        d.dataset.color=p.color;
        d.dataset.z=z;

        const img=document.createElement('img');
        img.src='assets/images/'+p.img+'.png';
        d.appendChild(img);

        d.onclick=()=>onTileClick(d);

        board.appendChild(d);
        tiles.push(d);
      }
    }
  });

  updateFree();
  renderInventory();
}

/* ===== LOGIKA ===== */

function updateFree(){
  tiles.forEach(t=>{
    const z=+t.dataset.z;
    const covered=tiles.some(o=>
      o!==t &&
      +o.dataset.z>z &&
      overlap(t,o)
    );
    t.classList.toggle('blocked',covered);
    t.classList.toggle('free',!covered);
  });
}

function overlap(a,b){
  return !(
    a.offsetLeft+a.offsetWidth<=b.offsetLeft ||
    a.offsetLeft>=b.offsetLeft+b.offsetWidth ||
    a.offsetTop+a.offsetHeight<=b.offsetTop ||
    a.offsetTop>=b.offsetTop+b.offsetHeight
  );
}

function onTileClick(t){
  if(t.classList.contains('blocked'))return;
  document.getElementById('clickSound').play();

  inventory.push(t);
  t.style.opacity=.3;

  if(inventory.length===4){
    checkInventory();
  }
  renderInventory();
}

function checkInventory(){
  const [a,b,c,d]=inventory;
  const ok=
    a.dataset.img===b.dataset.img &&
    b.dataset.img===c.dataset.img &&
    c.dataset.img===d.dataset.img &&
    a.dataset.color===b.dataset.color &&
    b.dataset.color===c.dataset.color &&
    c.dataset.color===d.dataset.color;

  if(ok){
    document.getElementById('pairSound').play();
    inventory.forEach(t=>{
      t.remove();
      tiles.splice(tiles.indexOf(t),1);
    });
    addScore();
  }else{
    inventory.forEach(t=>t.style.opacity=1);
  }
  inventory=[];
  updateFree();
}

function addScore(){
  const now=performance.now();
  const dt=(now-lastTime)/1000;
  lastTime=now;

  let pts=50,msg='good';
  if(dt<1.5){pts=500;msg='you are the legend!';}
  else if(dt<3.6){pts=350;msg='its impossible!';}
  else if(dt<5.1){pts=250;msg='insane';}
  else if(dt<7.6){pts=150;msg='awesome';}
  else if(dt<10){pts=100;msg='nice';}

  score+=pts;
  document.getElementById('score').textContent=score;
  document.getElementById('message').textContent=msg;
}

function renderInventory(){
  const inv=document.getElementById('inventory');
  inv.innerHTML='';
  inventory.forEach(t=>{
    const s=document.createElement('div');
    s.className='slot';
    const i=document.createElement('img');
    i.src=t.querySelector('img').src;
    i.style.width='80%';
    s.appendChild(i);
    inv.appendChild(s);
  });
}
</script>

</body>
</html>
